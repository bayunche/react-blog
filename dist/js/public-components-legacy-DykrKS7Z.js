System.register(["./react-vendor-legacy-L1Y0DLuJ.js","./admin-legacy-CVF4cueu.js"],function(a,e){"use strict";var t,o,r,s,n,i,l,d,c,m,p,u,f,g,b,x,h,_,w,v,y,j,k,C,z,N,S,F,L,P,I,G,T,M,R,U,$,B,E,A;return{setters:[a=>{t=a.a6,o=a.f,r=a.F,s=a.r,n=a.a7,i=a.j,l=a.I,d=a.a8,c=a.a9,m=a.B,p=a.aa,u=a.ab,f=a.ac,g=a.ad,b=a.H,x=a.O,h=a.ae,_=a.G,w=a.af,v=a.ag,y=a.T,j=a.C,k=a.u,C=a.ah,z=a.ai,N=a.aj,S=a.ak,F=a.X,L=a.N,P=a.al,I=a.am},a=>{G=a.s,T=a.u,M=a.G,R=a.a,U=a.b,$=a.g,B=a.A,E=a.c,A=a.d}],execute:function(){var e=document.createElement("style");e.textContent=".login-form__header{margin-bottom:24px;text-align:center}.login-form__header .form-title{color:#262626;font-size:20px;font-weight:600;margin:0 0 8px}.login-form__header .form-description{color:#8c8c8c;font-size:14px;margin:0}.login-form__form .ant-form-item{margin-bottom:20px}.login-form__form .ant-form-item-label{color:#262626;font-weight:500}.login-form__form .form-input{border-radius:6px;transition:all .3s ease}.login-form__form .form-input:hover{border-color:#40a9ff}.login-form__form .form-input.ant-input-focused,.login-form__form .form-input:focus{border-color:#40a9ff;box-shadow:0 0 0 2px rgba(24,144,255,.2)}.login-form__form .form-input .input-icon{color:#8c8c8c}.login-form__form .submit-btn{background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:6px;font-size:16px;font-weight:500;height:44px;transition:all .3s ease}.login-form__form .submit-btn:hover{box-shadow:0 4px 12px rgba(102,126,234,.4);transform:translateY(-1px)}.login-form__form .submit-btn:active{transform:translateY(0)}.login-form__footer{margin-top:16px;text-align:center}.login-form__footer .footer-text{color:#8c8c8c;font-size:14px;margin:0}.login-form__footer .switch-link{color:#1890ff;font-weight:500;padding:0 4px}.login-form__footer .switch-link:hover{color:#40a9ff}@media (max-width:480px){.login-form__header{margin-bottom:20px}.login-form__header .form-title{font-size:18px}.login-form__header .form-description{font-size:13px}.login-form__form .form-input{height:40px}.login-form__form .submit-btn{font-size:15px;height:40px}}.register-form__header{margin-bottom:24px;text-align:center}.register-form__header .form-title{color:#262626;font-size:20px;font-weight:600;margin:0 0 8px}.register-form__header .form-description{color:#8c8c8c;font-size:14px;margin:0}.register-form__form .ant-form-item{margin-bottom:18px}.register-form__form .ant-form-item-label{color:#262626;font-weight:500}.register-form__form .form-input{border-radius:6px;transition:all .3s ease}.register-form__form .form-input:hover{border-color:#40a9ff}.register-form__form .form-input.ant-input-focused,.register-form__form .form-input:focus{border-color:#40a9ff;box-shadow:0 0 0 2px rgba(24,144,255,.2)}.register-form__form .form-input .input-icon{color:#8c8c8c}.register-form__form .ant-form-item-has-success .ant-form-item-children-icon{color:#52c41a}.register-form__form .ant-form-item-has-warning .ant-form-item-children-icon{color:#faad14}.register-form__form .ant-form-item-has-error .ant-form-item-children-icon{color:#ff4d4f}.register-form__form .submit-btn{background:linear-gradient(135deg,#52c41a,#73d13d);border:none;border-radius:6px;font-size:16px;font-weight:500;height:44px;margin-top:8px;transition:all .3s ease}.register-form__form .submit-btn:hover{box-shadow:0 4px 12px rgba(82,196,26,.4);transform:translateY(-1px)}.register-form__form .submit-btn:active{transform:translateY(0)}.register-form__footer{margin-top:20px}.register-form__footer .password-tips{background:#f6ffed;border:1px solid #b7eb8f;border-radius:6px;margin-bottom:16px;padding:12px 16px}.register-form__footer .password-tips h4{color:#389e0d;font-size:13px;font-weight:600;margin:0 0 8px}.register-form__footer .password-tips ul{color:#52c41a;font-size:12px;margin:0;padding-left:16px}.register-form__footer .password-tips ul li{line-height:1.4;margin-bottom:2px}.register-form__footer .footer-text{color:#8c8c8c;font-size:14px;margin:0;text-align:center}.register-form__footer .switch-link{color:#1890ff;font-weight:500;padding:0 4px}.register-form__footer .switch-link:hover{color:#40a9ff}@media (max-width:480px){.register-form__header{margin-bottom:20px}.register-form__header .form-title{font-size:18px}.register-form__header .form-description{font-size:13px}.register-form__form .ant-form-item{margin-bottom:16px}.register-form__form .form-input{height:40px}.register-form__form .submit-btn{font-size:15px;height:40px}.register-form__footer .password-tips{padding:10px 12px}.register-form__footer .password-tips h4{font-size:12px}.register-form__footer .password-tips ul{font-size:11px}}.social-auth{margin-top:20px}.social-auth .divider{color:#8c8c8c;font-size:14px;margin:16px 0}.social-auth .divider .divider-text{background:#fff;padding:0 16px}.social-auth .divider .ant-divider-inner-text{color:#8c8c8c}.social-auth__content .github-btn{background:#24292e;border-color:#24292e;border-radius:6px;color:#fff;font-size:15px;font-weight:500;height:44px;transition:all .3s ease}.social-auth__content .github-btn:hover{background:#2f363d;border-color:#2f363d;box-shadow:0 4px 12px rgba(36,41,46,.3);transform:translateY(-1px)}.social-auth__content .github-btn:active{transform:translateY(0)}.social-auth__content .github-btn:focus{background:#24292e;border-color:#24292e}.social-auth__content .github-btn .anticon{font-size:18px}.social-auth__tips{color:#8c8c8c;font-size:12px;line-height:1.4;margin:12px 0 0;text-align:center}@media (max-width:480px){.social-auth__content .github-btn{font-size:14px;height:40px}.social-auth__content .github-btn .anticon{font-size:16px}.social-auth__tips{font-size:11px;margin-top:10px}}.sign-modal .ant-modal-content{border-radius:12px;box-shadow:0 12px 32px rgba(0,0,0,.12);overflow:hidden}.sign-modal .ant-modal-header{display:none}.sign-modal .ant-modal-body{padding:32px}.sign-modal__content .error-alert{border-radius:8px;margin-bottom:20px}.sign-modal__content .auth-tabs .ant-tabs-nav{margin-bottom:24px}.sign-modal__content .auth-tabs .ant-tabs-nav .ant-tabs-nav-wrap .ant-tabs-nav-list .ant-tabs-tab{border-radius:8px 8px 0 0;font-size:16px;font-weight:500;padding:12px 24px;transition:all .3s ease}.sign-modal__content .auth-tabs .ant-tabs-nav .ant-tabs-nav-wrap .ant-tabs-nav-list .ant-tabs-tab:hover{color:#40a9ff}.sign-modal__content .auth-tabs .ant-tabs-nav .ant-tabs-nav-wrap .ant-tabs-nav-list .ant-tabs-tab.ant-tabs-tab-active{color:#1890ff;font-weight:600}.sign-modal__content .auth-tabs .ant-tabs-nav .ant-tabs-nav-wrap .ant-tabs-nav-list .ant-tabs-tab.ant-tabs-tab-active .ant-tabs-tab-btn{color:#1890ff}.sign-modal__content .auth-tabs .ant-tabs-nav .ant-tabs-ink-bar{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:2px;height:3px}.sign-modal__content .auth-tabs .ant-tabs-content-holder .ant-tabs-content .ant-tabs-tabpane{padding:0}@media (max-width:540px){.sign-modal{max-width:420px;width:90%!important}.sign-modal .ant-modal-body{padding:24px 20px}.sign-modal__content .auth-tabs .ant-tabs-nav{margin-bottom:20px}.sign-modal__content .auth-tabs .ant-tabs-nav .ant-tabs-nav-wrap .ant-tabs-nav-list .ant-tabs-tab{font-size:15px;padding:10px 20px}}@media (max-width:420px){.sign-modal{width:95%!important}.sign-modal .ant-modal-body{padding:20px 16px}.sign-modal__content .auth-tabs .ant-tabs-nav{margin-bottom:16px}.sign-modal__content .auth-tabs .ant-tabs-nav .ant-tabs-nav-wrap .ant-tabs-nav-list .ant-tabs-tab{font-size:14px;padding:8px 16px}}@media (max-width:540px){.ant-modal-wrap{padding:20px 0}.ant-modal{margin:0 auto;padding-bottom:0}}.upload-dragger{background:#fafafa;border:2px dashed #d9d9d9;border-radius:8px;transition:all .3s ease}.upload-dragger:hover{background:#f0f8ff;border-color:#40a9ff}.upload-dragger:hover .ant-upload-drag-icon .anticon,.upload-dragger:hover .ant-upload-text{color:#40a9ff}.upload-dragger .ant-upload-drag-icon{margin-bottom:16px}.upload-dragger .ant-upload-drag-icon .anticon{color:#bfbfbf;font-size:48px;transition:color .3s ease}.upload-dragger .ant-upload-text{color:#666;font-size:16px;font-weight:500;margin-bottom:8px;transition:color .3s ease}.upload-dragger .ant-upload-hint{color:#999;font-size:14px;line-height:1.5;margin:0}.upload-dragger.ant-upload-drag-hover{background:#e6f7ff;border-color:#1890ff}.upload-dragger.ant-upload-drag-hover .ant-upload-drag-icon .anticon,.upload-dragger.ant-upload-drag-hover .ant-upload-text{color:#1890ff}@media (max-width:768px){.upload-dragger .ant-upload-drag-icon{margin-bottom:12px}.upload-dragger .ant-upload-drag-icon .anticon{font-size:40px}.upload-dragger .ant-upload-text{font-size:15px}.upload-dragger .ant-upload-hint{font-size:13px}}@media (max-width:480px){.upload-dragger{padding:20px 16px}.upload-dragger .ant-upload-drag-icon{margin-bottom:10px}.upload-dragger .ant-upload-drag-icon .anticon{font-size:36px}.upload-dragger .ant-upload-text{font-size:14px}.upload-dragger .ant-upload-hint{font-size:12px}}.upload-table{margin-top:20px}.upload-table .upload-files-table{border:1px solid #f0f0f0;border-radius:8px;overflow:hidden}.upload-table .upload-files-table .ant-table-thead>tr>th{background:#fafafa;border-bottom:1px solid #f0f0f0;color:#262626;font-weight:600}.upload-table .upload-files-table .ant-table-tbody>tr{transition:background-color .3s ease}.upload-table .upload-files-table .ant-table-tbody>tr:hover{background:#f8f9fa}.upload-table .upload-files-table .ant-table-tbody>tr>td{border-bottom:1px solid #f0f0f0;padding:12px 16px}.upload-table .upload-files-table .ant-table-tbody>tr>td .file-name{color:#1890ff;font-weight:500}.upload-table .upload-files-table .ant-table-tbody>tr>td .article-title{color:#262626;font-size:14px}.upload-table .upload-files-table .ant-table-tbody>tr>td .remove-btn{border:none;color:#ff4d4f;font-size:12px;height:auto;padding:4px 8px}.upload-table .upload-files-table .ant-table-tbody>tr>td .remove-btn:hover{background:rgba(255,77,79,.1);color:#ff4d4f}.upload-table .upload-files-table .ant-table-tbody>tr>td .remove-btn .anticon{font-size:12px}.upload-table .upload-files-table .ant-tag{border-radius:4px;font-size:12px;font-weight:500;padding:2px 8px}@media (max-width:768px){.upload-table{margin-top:16px}.upload-table .upload-files-table .ant-table-tbody>tr>td,.upload-table .upload-files-table .ant-table-thead>tr>th{font-size:13px;padding:8px 12px}.upload-table .upload-files-table .file-name{max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.upload-table .upload-files-table .article-title{max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}@media (max-width:576px){.upload-table .upload-files-table .ant-table-tbody>tr>td:nth-child(2),.upload-table .upload-files-table .ant-table-thead>tr>th:nth-child(2){display:none}.upload-table .upload-files-table .ant-table-tbody>tr>td,.upload-table .upload-files-table .ant-table-thead>tr>th{font-size:12px;padding:6px 8px}.upload-table .upload-files-table .file-name{max-width:80px}}.upload-summary{border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin:16px 0}.upload-summary .ant-card-body{padding:16px 20px}.upload-summary .ant-statistic{text-align:center}.upload-summary .ant-statistic .ant-statistic-title{color:#8c8c8c;font-size:13px;font-weight:500;margin-bottom:4px}.upload-summary .ant-statistic .ant-statistic-content .ant-statistic-content-value{align-items:center;display:flex;font-size:20px;font-weight:600;gap:6px;justify-content:center}.upload-summary .ant-statistic .ant-statistic-content .ant-statistic-content-prefix{font-size:16px;margin-right:0}@media (max-width:768px){.upload-summary{margin:12px 0}.upload-summary .ant-card-body{padding:12px 16px}.upload-summary .ant-statistic .ant-statistic-title{font-size:12px}.upload-summary .ant-statistic .ant-statistic-content .ant-statistic-content-value{font-size:18px}.upload-summary .ant-statistic .ant-statistic-content .ant-statistic-content-prefix{font-size:14px}}@media (max-width:480px){.upload-summary .ant-card-body{padding:10px 12px}.upload-summary .ant-row .ant-col{margin-bottom:8px}.upload-summary .ant-row .ant-col:last-child{margin-bottom:0}.upload-summary .ant-statistic .ant-statistic-title{font-size:11px;margin-bottom:2px}.upload-summary .ant-statistic .ant-statistic-content .ant-statistic-content-value{font-size:16px;gap:4px}.upload-summary .ant-statistic .ant-statistic-content .ant-statistic-content-prefix{font-size:12px}}.upload-modal .ant-modal-content{border-radius:12px;box-shadow:0 12px 32px rgba(0,0,0,.12);overflow:hidden}.upload-modal .ant-modal-header{background:linear-gradient(135deg,#667eea,#764ba2);border-bottom:none;padding:20px 24px}.upload-modal .ant-modal-header .ant-modal-title{color:#fff;font-size:18px;font-weight:600}.upload-modal .ant-modal-body{padding:24px}.upload-modal .ant-modal-footer{border-top:1px solid #f0f0f0;padding:16px 24px}.upload-modal .ant-modal-footer .ant-btn{border-radius:6px;font-weight:500;height:40px}.upload-modal .ant-modal-footer .ant-btn.ant-btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);border:none;transition:all .3s ease}.upload-modal .ant-modal-footer .ant-btn.ant-btn-primary:hover{box-shadow:0 4px 12px rgba(102,126,234,.4);transform:translateY(-1px)}.upload-modal .ant-modal-footer .ant-btn.ant-btn-primary:active{transform:translateY(0)}.upload-modal .ant-modal-footer .ant-btn.ant-btn-primary:disabled{background:#f5f5f5;box-shadow:none;transform:none}@media (max-width:768px){.upload-modal{max-width:720px;width:95%!important}.upload-modal .ant-modal-body{padding:20px 16px}.upload-modal .ant-modal-footer{padding:12px 16px}.upload-modal .ant-modal-footer .ant-btn{font-size:14px;height:36px}}@media (max-width:576px){.upload-modal{height:100vh;margin:0;max-width:none;width:100%!important}.upload-modal .ant-modal-content{border-radius:0;display:flex;flex-direction:column;height:100vh}.upload-modal .ant-modal-body{flex:1;overflow-y:auto;padding:16px 12px}.upload-modal .ant-modal-header{padding:16px}.upload-modal .ant-modal-footer{padding:12px}.ant-modal-wrap{padding:0}.ant-modal{margin:0;padding-bottom:0;top:0}}\n/*$vite$:1*/",document.head.appendChild(e),a("P",function(a){const e=E(a=>a.fetchTagList),t=E(a=>a.fetchCategoryList);return A(()=>{e(),t()}),i.jsxs(i.Fragment,{children:[i.jsx(X,{}),i.jsx(ra,{})]})});const O=t.enc.Utf8.parse("1234567890000000"),H=t.enc.Utf8.parse("1234567890000000"),Y={encrypt(a){let e="";if("string"==typeof a){const o=t.enc.Utf8.parse(a);e=t.AES.encrypt(o,O,{iv:H,mode:t.mode.CBC,padding:t.pad.Pkcs7})}else if("object"==typeof a){const o=JSON.stringify(a),r=t.enc.Utf8.parse(o);e=t.AES.encrypt(r,O,{iv:H,mode:t.mode.CBC,padding:t.pad.Pkcs7})}return e.ciphertext.toString()},decrypt(a){const e=t.enc.Hex.parse(a),o=t.enc.Base64.stringify(e);return t.AES.decrypt(o,O,{iv:H,mode:t.mode.CBC,padding:t.pad.Pkcs7}).toString(t.enc.Utf8).toString()}},q=a=>{const e={isValid:!1,message:"",score:0};if(!a)return e.message="密码不能为空",e;const t=/[A-Z]/.test(a),o=/[a-z]/.test(a),r=/\d/.test(a),s=/[!@#$%^&*(),.?":{}|<>]/.test(a);let n=0;return a.length>=8&&(n+=20),a.length>=12&&(n+=10),t&&(n+=20),o&&(n+=20),r&&(n+=20),s&&(n+=20),e.score=n,a.length<8?(e.message="密码长度至少需要8位",e):t&&o&&r?["12345678","123456789","password","qwerty123","abc123456","11111111","00000000"].includes(a.toLowerCase())?(e.message="不能使用常见的弱密码",e):/(.)\1{2,}/.test(a)?(e.message="密码不能包含连续重复的字符",e):(e.isValid=!0,e.message=n>=80?"密码强度：强":n>=60?"密码强度：中等":"密码强度：弱，建议添加特殊字符",e):(e.message="密码必须包含大写字母、小写字母和数字",e)},V=Object.freeze(Object.defineProperty({__proto__:null,default:Y,validatePassword:q},Symbol.toStringTag,{value:"Module"}));a("p",V);const D=({onSuccess:a,onClose:e}={})=>{const[t]=r.useForm(),[n,i]=s.useState(!1),{loginSuccess:l,setLoading:d,setError:c,clearError:m}=T(),p=s.useCallback(()=>{t.resetFields(),m()},[t,m]),u=s.useCallback((a,e)=>new Promise((a,o)=>{e&&e!==t.getFieldValue("password")?o(new Error("两次输入的密码不一致！")):a()}),[t]),f=s.useCallback(async t=>{try{i(!0),d(!0),m();const r=await(async a=>{void 0!==a.password&&(a.password=Y.encrypt(a.password));try{const e=await G.post("/login",a);return o.success(`登录成功, 欢迎您 ${e.username}`),e}catch(e){throw o.error(e.message||"登录失败"),e}})(t);l(r),o.success("登录成功！"),a?.(r,"login"),e?.()}catch(r){const a=r.response?.data?.message||r.message||"登录失败，请检查用户名和密码";c(a),o.error(a)}finally{i(!1),d(!1)}},[l,d,c,m,a,e]),g=s.useCallback(async e=>{try{i(!0),d(!0),m();const t=q(e.password);if(!t.isValid)return c(t.message),void o.error(t.message);if(e.password!==e.confirm){const a="两次输入的密码不一致";return c(a),void o.error(a)}const r=await(async a=>{void 0!==a.password&&(a.password=Y.encrypt(a.password));try{const e=await G.post("/register",a);return o.success("注册成功，请重新登录您的账号！"),e}catch(e){throw o.error(e.message||"注册失败"),e}})({username:e.username,password:e.password,email:e.email});o.success("注册成功！请使用新账号登录。"),a?.(r,"register"),p()}catch(t){const a=t.response?.data?.message||t.message||"注册失败，请重试";c(a),o.error(a)}finally{i(!1),d(!1)}},[d,c,m,a,p]),b=s.useCallback(async a=>{try{const e=await t.validateFields();"login"===a?await f(e):"register"===a&&await g(e)}catch(e){e.errorFields&&o.warning("请检查表单填写是否完整和正确")}},[t,f,g]),x=s.useCallback(()=>({login:{account:[{required:!0,message:"请输入用户名"},{min:2,message:"用户名至少2个字符"},{max:20,message:"用户名最多20个字符"}],password:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6个字符"}]},register:{username:[{required:!0,message:"请输入用户名"},{min:2,message:"用户名至少2个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/,message:"用户名只能包含字母、数字、下划线和中文"}],password:[{required:!0,message:"请输入密码"},{min:8,message:"密码至少8个字符"},{validator:(a,e)=>{if(!e)return Promise.resolve();const t=q(e);return t.isValid?Promise.resolve():Promise.reject(new Error(t.message))}}],confirm:[{required:!0,message:"请确认密码"},{validator:u}],email:[{required:!0,message:"请输入邮箱地址"},{type:"email",message:"请输入有效的邮箱地址"}]}}),[u]),h=s.useCallback(()=>({labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}),[]);return{form:t,submitting:n,handleSubmit:b,resetForm:p,getFormRules:x,getFormLayout:h}},K=({form:a,formLayout:e,formRules:t,submitting:o=!1,onSubmit:s,className:n=""})=>i.jsxs("div",{className:`login-form ${n}`,children:[i.jsxs("div",{className:"login-form__header",children:[i.jsx("h3",{className:"form-title",children:"用户登录"}),i.jsx("p",{className:"form-description",children:"请输入您的登录凭据"})]}),i.jsxs(r,{form:a,layout:"horizontal",...e,onFinish:s,className:"login-form__form",children:[i.jsx(r.Item,{label:"用户名",name:"account",rules:t.account,children:i.jsx(l,{prefix:i.jsx(d,{className:"input-icon"}),placeholder:"请输入用户名",size:"large",className:"form-input"})}),i.jsx(r.Item,{label:"密码",name:"password",rules:t.password,children:i.jsx(l.Password,{prefix:i.jsx(c,{className:"input-icon"}),placeholder:"请输入密码",size:"large",className:"form-input"})}),i.jsx(r.Item,{wrapperCol:{offset:e.labelCol.sm.span,span:e.wrapperCol.sm.span},children:i.jsx(m,{type:"primary",htmlType:"submit",loading:o,size:"large",block:!0,className:"submit-btn",children:o?"登录中...":"登录"})})]}),i.jsx("div",{className:"login-form__footer",children:i.jsxs("p",{className:"footer-text",children:["还没有账号？",i.jsx(m,{type:"link",size:"small",className:"switch-link",children:"立即注册"})]})})]}),Z=({form:a,formLayout:e,formRules:t,submitting:o=!1,onSubmit:s,className:n=""})=>i.jsxs("div",{className:`register-form ${n}`,children:[i.jsxs("div",{className:"register-form__header",children:[i.jsx("h3",{className:"form-title",children:"用户注册"}),i.jsx("p",{className:"form-description",children:"创建您的新账号"})]}),i.jsxs(r,{form:a,layout:"horizontal",...e,onFinish:s,className:"register-form__form",children:[i.jsx(r.Item,{label:"用户名",name:"username",rules:t.username,hasFeedback:!0,children:i.jsx(l,{prefix:i.jsx(d,{className:"input-icon"}),placeholder:"请输入用户名（2-20个字符）",size:"large",className:"form-input"})}),i.jsx(r.Item,{label:"密码",name:"password",rules:t.password,hasFeedback:!0,children:i.jsx(l.Password,{prefix:i.jsx(c,{className:"input-icon"}),placeholder:"请输入密码（至少8位，包含字母和数字）",size:"large",className:"form-input"})}),i.jsx(r.Item,{label:"确认密码",name:"confirm",rules:t.confirm,hasFeedback:!0,children:i.jsx(l.Password,{prefix:i.jsx(p,{className:"input-icon"}),placeholder:"请再次输入密码",size:"large",className:"form-input"})}),i.jsx(r.Item,{label:"邮箱",name:"email",rules:t.email,hasFeedback:!0,children:i.jsx(l,{prefix:i.jsx(u,{className:"input-icon"}),placeholder:"请输入邮箱地址",size:"large",className:"form-input"})}),i.jsx(r.Item,{wrapperCol:{offset:e.labelCol.sm.span,span:e.wrapperCol.sm.span},children:i.jsx(m,{type:"primary",htmlType:"submit",loading:o,size:"large",block:!0,className:"submit-btn",children:o?"注册中...":"注册"})})]}),i.jsxs("div",{className:"register-form__footer",children:[i.jsxs("div",{className:"password-tips",children:[i.jsx("h4",{children:"密码要求："}),i.jsxs("ul",{children:[i.jsx("li",{children:"至少8个字符"}),i.jsx("li",{children:"包含大小写字母"}),i.jsx("li",{children:"包含数字"}),i.jsx("li",{children:"可包含特殊字符"})]})]}),i.jsxs("p",{className:"footer-text",children:["已有账号？",i.jsx(m,{type:"link",size:"small",className:"switch-link",children:"立即登录"})]})]})]}),J=({available:a=!1,loading:e=!1,onGithubLogin:t,className:o=""})=>a?i.jsxs("div",{className:`social-auth ${o}`,children:[i.jsx(f,{className:"divider",children:i.jsx("span",{className:"divider-text",children:"或"})}),i.jsxs("div",{className:"social-auth__content",children:[i.jsx(m,{block:!0,size:"large",icon:i.jsx(g,{}),onClick:t,loading:e,className:"github-btn",children:e?"GitHub 登录中...":"使用 GitHub 登录"}),i.jsx("p",{className:"social-auth__tips",children:"使用 GitHub 登录将自动创建账号"})]})]}):null,{TabPane:W}=h,X=()=>{const[a,e]=s.useState(!1),[t,r]=s.useState("login"),[l,d]=s.useState(""),{handleGithubLogin:c,getGithubButtonConfig:m}=(()=>{const a=n(),e=s.useCallback(()=>!1,[]),t=s.useCallback((a={})=>{if(!e())throw new Error("GitHub登录未配置或不可用");const{state:t="",redirectUri:o=""}=a,s=M.url,n=M.client_id,i=new URLSearchParams({client_id:n,scope:"user:email",state:t||r()});return o&&i.append("redirect_uri",o),`${s}?${i.toString()}`},[e]),r=s.useCallback(()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),[]),i=s.useCallback(()=>{const{pathname:e,search:t}=a;R("prevRouter",`${e}${t}`),R("githubAuthTime",Date.now())},[a]),d=s.useCallback((a={})=>{const{onBeforeRedirect:r,onError:s}=a;try{if(!e()){const a="GitHub登录功能未启用或配置不完整";return o.error(a),void s?.(new Error(a))}i();const a=t();r?.(),window.location.href=a}catch(l){o.error(l.message||"GitHub登录失败"),s?.(l)}},[e,i,t]),c=s.useCallback(async(a,e)=>{try{return{code:a,state:e,timestamp:Date.now()}}catch(l){throw l}},[]),m=s.useCallback(()=>({available:e(),text:"GitHub 登录",icon:"GithubOutlined",type:"default",block:!0,style:{marginTop:12,borderColor:"#24292e",color:"#24292e"},disabled:!e()}),[e]),p=s.useCallback(()=>{localStorage.removeItem("prevRouter"),localStorage.removeItem("githubAuthTime")},[]);return{isGithubAuthAvailable:e,handleGithubLogin:d,handleGithubCallback:c,getGithubButtonConfig:m,generateAuthUrl:t,saveCurrentRoute:i,clearAuthStorage:p}})(),{form:p,submitting:u,handleSubmit:f,resetForm:g,getFormRules:_,getFormLayout:w}=D({onSuccess:(a,t)=>{e(!1),"register"===t&&(r("login"),g())},onClose:()=>{e(!1)}});U("openSignModal",a=>{g(),d(""),r(a||"login"),e(!0)});const v=s.useCallback(()=>{e(!1),d(""),g()},[g]),y=s.useCallback(a=>{r(a),d(""),g()},[g]),j=s.useCallback(async()=>{try{await f(t)}catch(a){}},[f,t]),k=s.useCallback(()=>{c({onBeforeRedirect:()=>{e(!1)},onError:a=>{d(a.message)}})},[c]),C=w(),z=_(),N=m();return i.jsx(b,{title:null,open:a,onCancel:v,footer:null,width:480,centered:!0,className:"sign-modal",destroyOnClose:!0,children:i.jsxs("div",{className:"sign-modal__content",children:[l&&i.jsx(x,{message:"操作失败",description:l,type:"error",showIcon:!0,closable:!0,onClose:()=>d(""),className:"error-alert"}),i.jsxs(h,{activeKey:t,onChange:y,centered:!0,className:"auth-tabs",children:[i.jsx(W,{tab:"登录",children:i.jsx(K,{form:p,formLayout:C,formRules:z.login,submitting:u,onSubmit:j})},"login"),i.jsx(W,{tab:"注册",children:i.jsx(Z,{form:p,formLayout:C,formRules:z.register,submitting:u,onSubmit:j})},"register")]}),i.jsx(J,{available:N.available,loading:u,onGithubLogin:k})]})})};function Q(a=!1){const[e,t]=s.useState(a),o=s.useCallback(()=>t(!0),[e]),r=s.useCallback(()=>t(!1),[e]),n=s.useCallback(()=>{"boolean"==typeof e&&t(e)},[e]);return{value:e,setTrue:o,setFalse:r,toggle:n}}const{Dragger:aa}=w,ea=({uploadConfig:a})=>i.jsxs(aa,{...a,className:"upload-dragger",children:[i.jsx("p",{className:"ant-upload-drag-icon",children:i.jsx(v,{})}),i.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),i.jsx("p",{className:"ant-upload-hint",children:"支持单个或批量上传，仅支持 Markdown (.md) 格式文件，单个文件不超过 10MB"})]}),ta=({fileList:a,getParsedFile:e,onRemoveFile:t})=>{const o=s.useMemo(()=>[{dataIndex:"name",title:"文件名",ellipsis:!0,render:a=>i.jsx("span",{title:a,className:"file-name",children:a})},{dataIndex:"title",title:"文章标题",ellipsis:!0,render:(a,t)=>{const o=e(t.name);return i.jsx("span",{title:o.title,className:"article-title",children:o.title||"解析中..."})}},{dataIndex:"status",title:"状态",width:100,render:(a,t)=>"error"===a?i.jsx(y,{color:"red",children:"上传失败"}):"uploading"===a?i.jsx(y,{color:"blue",children:"上传中"}):"done"===a?e(t.name).exist?i.jsx(y,{color:"gold",children:"更新"}):i.jsx(y,{color:"green",children:"新增"}):i.jsx(y,{color:"default",children:"等待中"})},{dataIndex:"uid",title:"操作",width:80,render:(a,e)=>i.jsx(m,{type:"text",size:"small",danger:!0,icon:i.jsx(j,{}),onClick:()=>t(a),className:"remove-btn",children:"删除"})}],[e,t]);return i.jsx("div",{className:"upload-table",children:i.jsx(k,{dataSource:a,columns:o,rowKey:"uid",pagination:!1,size:"small",className:"upload-files-table",locale:{emptyText:"暂无文件"}})})},oa=({fileList:a,getParsedFile:e})=>{const t=s.useMemo(()=>{const t={total:a.length,success:0,failed:0,newFiles:0,updateFiles:0};return a.forEach(a=>{if("done"===a.status){t.success++;const o=e(a.name);o.exist?t.updateFiles++:o.title&&t.newFiles++}else"error"===a.status&&t.failed++}),t},[a,e]);return 0===a.length?null:i.jsx(C,{className:"upload-summary",size:"small",children:i.jsxs(z,{gutter:16,justify:"center",children:[i.jsx(N,{span:6,children:i.jsx(S,{title:"总文件",value:t.total,prefix:i.jsx(F,{}),valueStyle:{color:"#1890ff"}})}),i.jsx(N,{span:6,children:i.jsx(S,{title:"新增",value:t.newFiles,prefix:i.jsx(L,{}),valueStyle:{color:"#52c41a"}})}),i.jsx(N,{span:6,children:i.jsx(S,{title:"更新",value:t.updateFiles,prefix:i.jsx(P,{}),valueStyle:{color:"#faad14"}})}),i.jsx(N,{span:6,children:i.jsx(S,{title:"失败",value:t.failed,prefix:i.jsx(I,{}),valueStyle:{color:"#ff4d4f"}})})]})})},ra=()=>{const{fileList:a,getParsedFile:e,removeFile:t,resetFiles:r,getUploadConfig:n,getUploadList:l}=(()=>{const[a,e]=s.useState([]),[t,r]=s.useState([]),n=s.useRef(null),i=s.useCallback(a=>t.find(e=>e.fileName===a)||{},[t]),l=s.useCallback(({file:a,fileList:t})=>{"done"===a.status&&(clearTimeout(n.current),n.current=setTimeout(()=>{const a=t.map(a=>a.name);a.length>0&&G.post("/article/checkExist",{fileNameList:a}).then(a=>{r(a)}).catch(a=>{o.error("检查文件状态失败")})},1e3)),e(t)},[]),d=s.useCallback(t=>{const o=a.findIndex(a=>a.uid===t);if(o>-1){const t=[...a];t.splice(o,1),e(t)}},[a]),c=s.useCallback(()=>{e([]),r([]),clearTimeout(n.current)},[]),m=s.useCallback(()=>({name:"file",multiple:!0,showUploadList:!1,action:`${B}/article/upload`,onChange:l,headers:{Authorization:$()},accept:"text/markdown",beforeUpload:a=>"text/markdown"===a.type||a.name.endsWith(".md")?!!(a.size/1024/1024<10)||(o.error("文件大小不能超过 10MB!"),!1):(o.error("只能上传 Markdown 文件!"),!1)}),[l]),p=s.useCallback(()=>a.reduce((a,e)=>{if("done"===e.status){const o=t.find(a=>e.name===a.fileName);o&&a.push(o)}return a},[]),[a,t]);return{fileList:a,parsedList:t,getParsedFile:i,handleFileChange:l,removeFile:d,resetFiles:c,getUploadConfig:m,getUploadList:p}})(),{handleSubmit:d,getSubmitButtonProps:c}=(()=>{const a=T(a=>a.user?.userId),e=Q(!1),t=s.useCallback(async(t,o,r)=>{if(t&&0!==t.length)try{e.setTrue();const r=await G.post("/article/upload/confirm",{authorId:a,uploadList:t});_.success({message:"上传成功",description:`插入文章数: ${r.insertList.length}，更新文章数: ${r.updateList.length}`,duration:4.5}),"function"==typeof o&&o(r)}catch(s){const a=s.response?.data?.message||s.message||"上传失败，请重试";_.error({message:"上传失败",description:a,duration:6}),"function"==typeof r&&r(s)}finally{e.setFalse()}else _.warning({message:"提示",description:"请选择要上传的文件"})},[a,e]),o=s.useCallback((a=0)=>({loading:e.value,disabled:0===a,type:"primary"}),[e.value]);return{confirmLoading:e.value,handleSubmit:t,getSubmitButtonProps:o}})(),{closeModal:m,getModalConfig:p}=(({onOpen:a,onClose:e}={})=>{const{value:t,setTrue:o,setFalse:r}=Q(!1),n=s.useCallback(()=>{o(),"function"==typeof a&&a()},[o,a]),i=s.useCallback(()=>{r(),"function"==typeof e&&e()},[r,e]);U("openUploadModal",n);const l=s.useCallback(()=>({width:760,open:t,title:"导入文章",onCancel:i,maskClosable:!1,destroyOnClose:!0,centered:!0,className:"upload-modal"}),[t,i]);return{visible:t,openModal:n,closeModal:i,getModalConfig:l}})({onOpen:r,onClose:r}),u=n(),f=p(),g=c(a.length);return i.jsxs(b,{...f,onOk:async()=>{const a=l();await d(a,m)},okButtonProps:g,okText:"确认导入",cancelText:"取消",children:[i.jsx(ea,{uploadConfig:u}),i.jsx(oa,{fileList:a,getParsedFile:e}),a.length>0&&i.jsx(ta,{fileList:a,getParsedFile:e,onRemoveFile:t})]})}}}});
